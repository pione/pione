Rule Main
  input 'list.txt'
  output 'sum.txt'
Flow----------------------------------------------------------------------------
rule MakeHeadTail
rule Sum.sync
rule Aggregation
-----------------------------------------------------------------------------End

Rule MakeHeadTail
  input 'list.txt'
  output 'head1.txt'
  output 'head2.txt'
  output 'head3.txt'
  output 'head4.txt'
  output 'head5.txt'
  output 'tail1.txt'
  output 'tail2.txt'
  output 'tail3.txt'
  output 'tail4.txt'
  output 'tail5.txt'
Action--------------------------------------------------------------------------
#!/usr/bin/env ruby
i = 1
File.readlines('list.txt').each do |line|
  head, tail = line.split(',')
  File.open("head#{i}.txt", "w+"){|f| f.print head}
  File.open("tail#{i}.txt", "w+"){|f| f.print tail}
  i += 1
end
-----------------------------------------------------------------------------End

Rule Sum
  input 'head*.txt'
  input 'tail{$INPUT[1].MATCH[1]}.txt'
  output 'sum{$INPUT[1].MATCH[1]}.txt'.stdout
Action--------------------------------------------------------------------------
expr {$INPUT[1].VALUE} + {$INPUT[2].VALUE}
-----------------------------------------------------------------------------End

Rule Aggregation
  input-all 'sum*.txt'
  output 'sum.txt'.stdout
Action--------------------------------------------------------------------------
#!/usr/bin/env ruby
'{$INPUT[1].LIST}'.split(':').each do |filename|
  puts File.read(filename)
end
-----------------------------------------------------------------------------End
